<template>
  <!--    å¯¼èˆªæ -->
  <el-menu mode="horizontal" :default-active="isShow">
    <el-menu-item index="1" @click="changePage('1')">
      ç½‘ç«™ä»‹ç»
    </el-menu-item>
    <el-menu-item index="2" @click="changePage('2','2')">
      æ›´æ–°ç›¸å…³
    </el-menu-item>
    <el-menu-item index="3" @click="changePage('3')">
      è”ç³»å’Œåé¦ˆ
    </el-menu-item>
  </el-menu>

  <el-scrollbar height="350px">
    <!--       ç½‘ç«™ä»‹ç»åŒº-->
    <el-collapse-transition accordion v-show="isShow==='1'">
      <el-collapse v-model="activeName">
        <el-collapse-item title="ç½‘ç«™ä»‹ç»" name="1">
          <el-card class="notice">
            <el-text>
              1.æœ¬ç«™ä¸ºç¤¾äº¤åŒ–å¯¼èˆªç½‘ç«™ï¼Œæä¾›
              <el-button-group type="primary">
                <el-button link title="é¦–é¡µå¯¼èˆª" @click="router.push({name:'home'})">ç«™ç‚¹å¯¼èˆªã€</el-button>
                <el-button link title="è®ºå›æ–‡ç« " target="_blank" @click="router.push({name:'forum'})">è®ºå›äº¤æµã€
                </el-button>
                <el-button link title="é‡è¿”æœªæ¥ç›¸å…³ç•Œé¢" @click="router.push({name:'reverse1999'})">
                  é‡è¿”æœªæ¥å®˜å›¾ç­›é€‰å’Œä¸‹è½½
                </el-button>
              </el-button-group>
              ç­‰åŠŸèƒ½ã€‚<br>
              2.
              <el-button-group target="_blank" type="primary">
                <el-button link
                           @click="copyText('1005993749','QQç¾¤å·','https://qm.qq.com/cgi-bin/qm/qr?k=64Jtp9gH81G0ndqR_TGeUZLrP_MKE9eU&jump_from=webapi&authKey=BkihB0yK7m3dhvou57J/OPWP+7BsDBirgRKjud/BIWnXa9pM40wSwo0ORdMHlE5V')"
                           title="ç‚¹å‡»å‰å¾€QQ">å·¥å…·èµ„æºç¾¤ï¼šResource sharingç¾¤ã€
                </el-button>
                <el-button link
                           @click="copyText('904688184','QQç¾¤å·','https://qm.qq.com/q/Oq8R7YS6sM')"
                           title="ç‚¹å‡»å‰å¾€QQ">
                  é‡è¿”æœªæ¥ç¾¤ï¼šé‡‘å…”å­ç‰¹ä¾›éƒ¨é—¨ğŸ°
                </el-button>
              </el-button-group>
              ,
              <el-text style="color: orangered">èµ„æºæ¥è‡ªç½‘ç»œ,ä¾µæƒè¯·è”ç³»åˆ é™¤</el-text>
              ã€‚
            </el-text>
            <br>
            <el-text>
              3.è‹¥é¦–é¡µå¯¼èˆªç½‘ç«™æ— æ³•è®¿é—®ï¼Œè¯·ä½¿ç”¨Chromeã€Edgeã€Firefoxç­‰æµè§ˆå™¨æˆ–å°è¯•VPNï¼Œä¹Ÿå¯èƒ½æ˜¯å› ä¸ºè¯¥ç½‘ç«™ç»´æŠ¤ä¸­ã€‚
            </el-text>
            <br>
            <el-text>4.ä½ å¯ä»¥
              <el-link target="_blank" type="success"
                       href="https://mp-00526be3-cd12-41bd-84f7-bfbce63bb7d0.cdn.bspapp.com/test1/BookMarks_2023_8_15_2.zip"
                       title="ä¸‹è½½ä¹¦ç­¾">ä¸‹è½½
              </el-link>
              å¹¶è§£å‹å‡ºHTMLæ–‡ä»¶ï¼Œå¯¼å…¥åˆ°è‡ªå·±çš„æµè§ˆå™¨æ”¶è—å¤¹ã€‚å¯¼å…¥æ­¥éª¤å¯å‚è€ƒç›¸å…³æ•™ç¨‹è§†é¢‘ï¼š
              <el-link target="_blank" type="primary"
                       href="https://www.bilibili.com/video/BV1rr4y1S79J/"
                       title="Bç«™æ•™ç¨‹è§†é¢‘">ç‚¹å‡»æ­¤å¤„
              </el-link>
              ã€‚
            </el-text>
            <br>
            <el-text>
              5.æœ¬ç«™æ­£åœ¨æŒç»­æ›´æ–°å’Œé€‚é…ç§»åŠ¨ç«¯ï¼Œå¦‚<el-text type="warning">UIé”™ä½</el-text>æˆ–<el-text type="danger">åŠŸèƒ½å‡ºé”™</el-text>è¯·
              <el-button link title="å‰å¾€åé¦ˆ" type="primary" @click="changePage('3','2')">ç•™è¨€åé¦ˆ</el-button>
              ã€‚
            </el-text>
          </el-card>
        </el-collapse-item>
        <el-collapse-item title="å‹æƒ…é“¾æ¥" name="2">
          <template class="friendLinks">
            <el-link target="_blank"
                     href="https://letsgofishing5.github.io/lsgfish-resource-sharing/"
                     title="èµ„æºæ”¶è—ä¸åˆ†äº«">
              <el-button><img src="@/assets/custom.png" alt="" style="width: 25px">&ensp;
                lsgfish-resource-sharing
              </el-button>
            </el-link>
            <el-link target="_blank" v-if="false"
                     href="https://answer.lilemy.cn/"
                     title="å°æ–°é—®ç­”">
              <el-button><img src="@/assets/logo.xiaoxin.png" alt="" style="width: 25px">&ensp;
                å°æ–°é—®ç­”
              </el-button>
            </el-link>
          </template>
        </el-collapse-item>
        <el-collapse-item title="éšç§æ”¿ç­–" name="3">
          <el-card class="privacyStatement">
            <el-text>
              æœ¬ç«™ä¸ Microsoft Clarity åˆä½œï¼Œé€šè¿‡è¡Œä¸ºæŒ‡æ ‡ã€çƒ­å›¾å’Œä¼šè¯å›æ”¾æ¥æ•æ‰æ‚¨å¦‚ä½•ä½¿ç”¨æœ¬ç«™çš„ç½‘ç«™å¹¶ä¸ä¹‹äº’åŠ¨ï¼Œä»¥æ”¹è¿›æœ¬ç«™çš„äº§å“å’ŒæœåŠ¡ã€‚ç½‘ç«™ä½¿ç”¨æ•°æ®æ˜¯é€šè¿‡ç¬¬ä¸€æ–¹å’Œç¬¬ä¸‰æ–¹
              Cookie ä»¥åŠå…¶ä»–è·Ÿè¸ªæŠ€æœ¯æ•è·çš„ï¼Œä»¥ç¡®å®šäº§å“å’ŒæœåŠ¡çš„å—æ¬¢è¿ç¨‹åº¦å’Œåœ¨çº¿æ´»åŠ¨ã€‚æ­¤å¤–ï¼Œæœ¬ç«™å°†è¿™äº›ä¿¡æ¯ç”¨äºç½‘ç«™ä¼˜åŒ–ã€‚æœ‰å…³
              Microsoft å¦‚ä½•æ”¶é›†å’Œä½¿ç”¨æ‚¨çš„æ•°æ®çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·è®¿é—®
              <el-link type="primary" href="https://privacy.microsoft.com/zh-CN/privacystatement">Microsoft éšç§å£°æ˜
              </el-link>
              ã€‚ä½¿ç”¨æœ¬ç«™ï¼Œå³è¡¨ç¤ºæ‚¨åŒæ„æœ¬ç«™å’Œ Microsoft å¯ä»¥æ”¶é›†å’Œä½¿ç”¨æ­¤æ•°æ®ã€‚
            </el-text>
            <br>
            <el-text><b>
              PS:æ ¹æ®å›½å®¶æ³•å¾‹æ³•è§„ï¼Œæœ¬ç«™ä»…æ”¶é›†è®¿é—®è€…IPç­‰èº«ä»½ä¿¡æ¯ï¼Œä½¿ç”¨Clarityæ”¶é›†è®¿é—®è€…åœ¨æœ¬ç«™çš„æµè§ˆè½¨è¿¹ä»¥ç¡®å®šbugä½ç½®è¿›è¡Œä¼˜åŒ–ï¼Œç›¸å…³çš„è´¦å·ã€å¯†ç ç­‰éšç§ä¿¡æ¯å‡ä¸ä¼šè¢«é‡‡é›†ã€‚
            </b>
            </el-text>
          </el-card>
        </el-collapse-item>
      </el-collapse>
    </el-collapse-transition>

    <!--    æ›´æ–°ç›¸å…³-->
    <el-collapse-transition v-show="isShow==='2'">
      <el-collapse v-model="activeName" accordion style="border: none;text-align: left">
        <!--    å¾…æ›´æ–°çš„åŠŸèƒ½-->
        <el-collapse-item title="å¾…æ›´æ–°çš„åŠŸèƒ½" name="1">
          <template v-for="item in noUpdated" :key="item.id">
            <el-button text :icon="Edit">{{ item.content }}</el-button>
            <br>
          </template>
        </el-collapse-item>
        <el-collapse-item title="å·²æ›´æ–°çš„å…¬å‘Š" name="2">
          <el-timeline style="padding-left: 0"><br>
            <el-timeline-item v-for="item in  updateNotes.slice().reverse()" :key="item.id" style="text-align: left"
                              :timestamp="item.time" placement="top">
              <el-card>
                <b>{{ item.title }}</b><br>
                <el-text> &ensp;{{ item.content }}</el-text>
              </el-card>
            </el-timeline-item>
          </el-timeline>
        </el-collapse-item>
      </el-collapse>
    </el-collapse-transition>

    <!--è”ç³»å’Œåé¦ˆ-->
    <el-collapse-transition v-show="isShow==='3'">
      <el-collapse v-model="activeName" accordion style="border: none">
        <!--è”ç³»æ–¹å¼-->
        <el-collapse-item title="è”ç³»æ–¹å¼" name="1">
          <template style="display: flex;justify-content: space-around">
            <el-button link tag="a" type="primary"
                       @click="copyText('50011502001039','QQå·','tencent://message/?uin=1224021291')">QQ
            </el-button>
            <el-button link tag="a" type="primary"
                       @click="copyText('50011502001039','å¾®åšä¸»é¡µé“¾æ¥','https://weibo.com/u/6869134755')">å¾®åš
            </el-button>
          </template>

        </el-collapse-item>
        <!--    ç•™è¨€åé¦ˆ-->
        <el-collapse-item title="ç•™è¨€åé¦ˆ" name="2">
          <el-form style="margin: 0 5%">
            <el-form-item label="è”ç³»æ–¹å¼ï¼š">
              <el-input type="text" v-model.trim="contact" maxlength="30"
                        placeholder="[é€‰å¡«]å¯åœ¨æ­¤å¡«å†™è”ç³»æ–¹å¼"></el-input>
            </el-form-item>
            <el-form-item label="åé¦ˆå†…å®¹ï¼š">
              <el-input type="textarea" v-model.trim="content" minlength="5" maxlength="200" :autosize="true"
                        show-word-limit
                        placeholder="[å¿…å¡«]å¯åœ¨æ­¤æäº¤å»ºè®®ã€bugåé¦ˆæˆ–å…¶ä»–å†…å®¹"/>
            </el-form-item>
          </el-form>
          <el-button type="primary" @click="submitFeedback">æäº¤åé¦ˆ</el-button>
        </el-collapse-item>
      </el-collapse>
    </el-collapse-transition>
    <!--å¤‡æ¡ˆå·-->
    <Approve/>
    <!--    <el-divider>å·²åŠ è½½å…¨éƒ¨å†…å®¹</el-divider>-->
  </el-scrollbar>
</template>

<script setup lang="ts">
import axios from "axios";
import {onMounted, reactive, ref} from "vue";
import {Edit} from "@element-plus/icons-vue";
import {ElCollapseTransition, ElMessage} from 'element-plus'
import useTimeStamp from "@/hooks/useTimestamp";
import useFunction from "@/hooks/useFunction";
import {useRouter} from "vue-router";
import Approve from "@/components/Approve.vue";


const {copyText} = useFunction()
const {getDiffTime} = useTimeStamp()
const router = useRouter()

const {showFlag} = defineProps(['showFlag'])//åˆ‡æ¢é¡µé¢çš„å‚æ•°

const updateNotes = reactive<Notice[]>([])//å·²æ›´æ–°çš„å…¬å‘Š
const noUpdated = reactive<Notice[]>([])//æœªæ›´æ–°çš„å…¬å‘Š
const isShow = ref<string>('1') //æ˜¾ç¤ºç¬¬å‡ ä¸ªå…¬å‘ŠåŒº
const activeName = ref<string[]>(['1'])//å±•å¼€ç¬¬å‡ æ¡,å› ä¸ºè®¾ç½®äº†accordionï¼Œæ‰€ä»¥å¿…é¡»æ˜¯å­—ç¬¦ä¸²æ ¼å¼
const contact = ref('')//åé¦ˆè”ç³»æ–¹å¼
const content = ref('')//åé¦ˆå†…å®¹


onMounted(() => {
  getNotices()//è·å–å…¬å‘Š
  if (!!showFlag) changePage(showFlag.showNum, showFlag.activeNum)//æ›´æ¢é¡µé¢
})


//åˆ‡æ¢å…¬å‘Šé¡µé¢
const changePage = (showNum: string, activeNum = '1') => {
  isShow.value = showNum
  setTimeout(() => activeName.value = activeNum.split(','), 300)
}


//è·å–å·²å‘å¸ƒå…¬å‘Š
const getNotices = async () => {
  try {
    const result = await axios({
      url: '/getNotices',
      params: {sort: ['updateNotes', 'noUpdated']}
    })
    // console.log(result)
    const {noticeList} = result.data
    updateNotes.splice(0, updateNotes.length)
    noUpdated.splice(0, noUpdated.length)
    noticeList.forEach((item: Notice) => {
      if (item.created_time === item.updated_time) item.time = 'å‘å¸ƒæ—¶é—´ï¼š' + getDiffTime(item.created_time)
      else item.time = 'å‘å¸ƒæ—¶é—´ï¼š' + getDiffTime(item.created_time) + '  ä¸Šæ¬¡ä¿®è®¢äºï¼š' + getDiffTime(item.updated_time)
      if (item.sort === 'updateNotes') updateNotes.push(item)
      if (item.sort === 'noUpdated') noUpdated.push(item)
    })
  } catch (error) {
    console.log('å‘ç”Ÿé”™è¯¯ï¼š')
    console.dir(error)
  }
}


//ä¸Šä¼ åé¦ˆå†…å®¹
const submitFeedback = async () => {
  console.log(content.value.length)
  if (content.value === '') return ElMessage.error('åé¦ˆå†…å®¹ä¸èƒ½ä¸ºç©º')
  if (contact.value.length > 30) return ElMessage.error('è”ç³»æ–¹å¼è¶…å‡ºé•¿åº¦é™åˆ¶')
  if (content.value.length < 5 || content.value.length > 200) return ElMessage.error('åé¦ˆå†…å®¹åº”ä¸º5-200ä¸ªå­—ç¬¦')
  try {
    const result = await axios({
      url: '/submitFeedback',
      method: 'post',
      data: {
        contact: contact.value,
        content: content.value
      }
    })
    console.log('result', result)
    contact.value = ''
    content.value = ''
    ElMessage.success(result.data.msg)
  } catch (error) {
    console.log('å‘ç”Ÿé”™è¯¯ï¼š')
    console.dir(error)
  }
}


</script>

<style scoped>
.notice {
  text-align: left;
}

/*æŠ˜å é¢æ¿æ ‡é¢˜æ æ ·å¼*/
:deep(.el-collapse-item__header:hover) {
  color: var(--el-color-primary);
}

.friendLinks {
  display: flex;
  justify-content: left
}

.friendLinks .el-link {
  margin: 0 10px;
}

.privacyStatement {
  display: flex;
  justify-content: left;
  text-align: left;

}

/*
@media (max-width: 980px) {

}*/
</style>
